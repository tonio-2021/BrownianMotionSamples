<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<title>Brownsche Bewegung im Ringgebiet</title>
<style>
  body { font-family: system-ui, sans-serif; display: flex; justify-content: center; align-items: flex-start; height: 100vh; margin: 0; background: #f5f5f5; }
  #wrapper { position: relative; }
  canvas { border: 1px solid #ccc; background: #fff; }
  #controls { position: absolute; top: 10px; right: -180px; display: flex; flex-direction: column; gap: 0.5rem; }
  .btn {
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
    cursor: pointer;
    border: 1px solid #666;
    border-radius: 0.3rem;
    background: #eee;
    transition: background 0.2s;
    text-align: left;
  }
  .btn:hover { background: #ddd; }
</style>
</head>
<body>
  <div id="wrapper">
    <canvas id="annulusCanvas" width="600" height="600"></canvas>
    <div id="controls">
      <button id="newPathBtn" class="btn">Neuer Pfad</button>
      <button id="newStartBtn" class="btn">Neuer Startpunkt</button>
      <button id="togglePathsBtn" class="btn">Pfade Verstecken</button>
      <button id="resetBtn" class="btn">Reset</button>
    </div>
  </div>

  <script>
    const canvas = document.getElementById('annulusCanvas');
    const ctx = canvas.getContext('2d');
    const WIDTH = canvas.width, HEIGHT = canvas.height;

    const R_OUTER = 1.0, R_INNER = 0.5;
    const SCALE = WIDTH * 0.4;

    function toCanvasX(x) { return WIDTH/2 + x * SCALE; }
    function toCanvasY(y) { return HEIGHT/2 - y * SCALE; }

    function drawBoundary() {
      ctx.clearRect(0, 0, WIDTH, HEIGHT);
      ctx.lineWidth = 2;
      ctx.strokeStyle = '#888'; ctx.setLineDash([]);
      ctx.beginPath(); ctx.arc(WIDTH/2, HEIGHT/2, R_OUTER*SCALE, 0, 2*Math.PI); ctx.stroke();
      ctx.setLineDash([6,4]);
      ctx.beginPath(); ctx.arc(WIDTH/2, HEIGHT/2, R_INNER*SCALE, 0, 2*Math.PI); ctx.stroke();
      ctx.setLineDash([]);
    }

    function randomStart() {
      const u=Math.random();
      const r0=Math.sqrt(u*(R_OUTER*R_OUTER - R_INNER*R_INNER) + R_INNER*R_INNER);
      const theta0=Math.random()*2*Math.PI;
      return [r0*Math.cos(theta0), r0*Math.sin(theta0)];
    }

    function randnBM() {
      let u=0, v=0;
      while(!u) u=Math.random(); while(!v) v=Math.random();
      return Math.sqrt(-2*Math.log(u)) * Math.cos(2*Math.PI*v);
    }

    function simulateBrownian(x0, dt=0.001, maxSteps=200000) {
      const path=[]; let [x,y]=x0; path.push([x,y]);
      for(let i=0;i<maxSteps;i++){
        x += Math.sqrt(dt)*randnBM(); y += Math.sqrt(dt)*randnBM();
        const d = Math.hypot(x,y);
        if(d>=R_OUTER) { x*=R_OUTER/d; y*=R_OUTER/d; path.push([x,y]); break; }
        if(d<=R_INNER) { x*=R_INNER/d; y*=R_INNER/d; path.push([x,y]); break; }
        path.push([x,y]);
      }
      return path;
    }

    const colours=['#e41a1c','#377eb8','#4daf4a','#984ea3','#ff7f00','#a65628','#f781bf','#999999'];
    let startPoint=null, paths=[], showPaths=true;

    function drawAll() {
      drawBoundary();
      paths.forEach((path,i)=>{
        const col=colours[i % colours.length];
        if(showPaths) {
          ctx.lineWidth=1.2; ctx.strokeStyle=col;
          ctx.beginPath(); ctx.moveTo(toCanvasX(path[0][0]), toCanvasY(path[0][1]));
          path.slice(1).forEach(p=>ctx.lineTo(toCanvasX(p[0]), toCanvasY(p[1])));
          ctx.stroke();
        }
        // Start- und Endpunkte
        ctx.fillStyle=col;
        [[path[0]], [path[path.length-1]]].forEach(ptArray=>{
          const [px,py] = ptArray[0];
          ctx.beginPath(); ctx.arc(toCanvasX(px), toCanvasY(py), 4, 0, 2*Math.PI); ctx.fill();
        });
      });
      // Startpunkt-Indikator
      if(startPoint&&showPaths){ ctx.fillStyle='#000'; ctx.beginPath();
        ctx.arc(toCanvasX(startPoint[0]), toCanvasY(startPoint[1]), 6, 0, 2*Math.PI); ctx.fill(); }
    }

    document.getElementById('newPathBtn').addEventListener('click', ()=>{
      if(!startPoint) startPoint = randomStart();
      paths.push(simulateBrownian(startPoint)); drawAll();
    });

    document.getElementById('newStartBtn').addEventListener('click', ()=>{
      startPoint = randomStart(); drawAll();
    });

    document.getElementById('togglePathsBtn').addEventListener('click', (e)=>{
      showPaths = !showPaths;
      e.target.textContent = showPaths ? 'Pfade Verstecken' : 'Pfade Zeigen';
      drawAll();
    });

    document.getElementById('resetBtn').addEventListener('click', ()=>{
      startPoint = null; paths = []; showPaths = true;
      document.getElementById('togglePathsBtn').textContent = 'Pfade Verstecken';
      drawAll();
    });

    // Initial draw
    drawBoundary();
  </script>
</body>
</html>
